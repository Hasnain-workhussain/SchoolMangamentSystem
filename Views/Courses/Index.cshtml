@using System.Linq
@model IEnumerable<SchoolMangamentSystem.ViewModels.Course>

@{
    ViewData["Title"] = "Course Management";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    .category-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
        color: #f1f5f9;
        background-color: #4338ca;
    }

    .course-thumbnail {
        width: 80px;
        height: 60px;
        object-fit: cover;
        border-radius: 0.375rem;
    }
</style>

<div class="p-6">

    <div class="mb-6 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-white">Course Management</h1>
        <a asp-action="Create" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-md text-white flex items-center transition-colors shadow-lg shadow-indigo-500/20">
            <i data-feather="plus" class="w-4 h-4 mr-2"></i> Add Course
        </a>
    </div>

    <form asp-action="Index" method="get" class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">

        <div class="relative flex-1">
            <i data-feather="search" class="absolute left-3 top-3 text-slate-400 w-4 h-4"></i>
            <input type="text" name="searchString" value="@ViewData["CurrentFilter"]"
                   placeholder="Search courses..."
                   class="w-full pl-10 pr-3 py-2 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400">
        </div>

        <div class="flex gap-2 w-full md:w-auto">
            <select name="categoryFilter" class="px-3 py-2 rounded-md bg-slate-700 border border-slate-600 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="">All Categories</option>
                @foreach (var cat in new[] { "Computer Science", "Mathematics", "Science", "Business", "Art" })
                {
                    if (ViewData["CurrentCategory"]?.ToString() == cat)
                    {
                        <option value="@cat" selected>@cat</option>
                    }
                    else
                    {
                        <option value="@cat">@cat</option>
                    }
                }
            </select>

            <select name="sortBy" class="px-3 py-2 rounded-md bg-slate-700 border border-slate-600 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                @{
                    var sort = ViewData["CurrentSort"]?.ToString();
                }

                <option value="name-asc" selected="@(sort == "name-asc" ? "selected" : null)">Name (A-Z)</option>
                <option value="name-desc" selected="@(sort == "name-desc" ? "selected" : null)">Name (Z-A)</option>
                <option value="price-asc" selected="@(sort == "price-asc" ? "selected" : null)">Price (Low to High)</option>
                <option value="price-desc" selected="@(sort == "price-desc" ? "selected" : null)">Price (High to Low)</option>
            </select>

            <button type="submit" class="bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white px-4 py-2 rounded-md transition-colors">
                Filter
            </button>
        </div>
    </form>

    <div class="overflow-x-auto bg-slate-800 rounded-xl shadow-sm border border-slate-700">
        <table class="min-w-full divide-y divide-slate-700 text-left">
            <thead class="bg-slate-900/50 text-slate-300 text-xs uppercase font-medium">
                <tr>
                    <th class="px-4 py-3">Course Name</th>
                    <th class="px-4 py-3">Category</th>
                    <th class="px-4 py-3">Price</th>
                    <th class="px-4 py-3">Thumbnail</th>
                    <th class="px-4 py-3">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-700 text-sm">
                @if (Model == null || !Model.Any())
                {
                    <tr><td colspan="5" class="p-6 text-center text-slate-500">No courses found.</td></tr>
                }
                else
                {
                    @foreach (var course in Model)
                    {
                        <tr class="hover:bg-slate-700/30 transition-colors">
                            <td class="px-4 py-3">
                                <div class="font-medium text-white">@course.CourseName</div>
                                <div class="text-xs text-slate-400 mt-0.5">
                                    @(course.Description != null && course.Description.Length > 60 ? course.Description.Substring(0, 60) + "..." : course.Description)
                                </div>
                            </td>
                            <td class="px-4 py-3">
                                <span class="category-badge">@course.Category</span>
                            </td>
                            <td class="px-4 py-3 text-slate-200">$@course.Price.ToString("F2")</td>

                            <td class="px-4 py-3">
                                @if (course.CourseImage != null && course.CourseImage.Length > 0)
                                {
                                    <img src="data:image/jpeg;base64,@Convert.ToBase64String(course.CourseImage)" alt="@course.CourseName" class="course-thumbnail bg-slate-700">
                                }
                                else
                                {
                                    <div class="course-thumbnail bg-slate-700 flex items-center justify-center text-slate-500 text-xs border border-slate-600">No Img</div>
                                }
                            </td>

                            <td class="px-4 py-3">
                                <div class="flex items-center gap-3">

                                    <a asp-action="Edit" asp-route-id="@course.Id" class="text-indigo-400 hover:text-indigo-300 transition-colors" title="Edit">
                                        <i data-feather="edit" class="w-4 h-4"></i>
                                    </a>

                                    <form asp-action="Delete" asp-route-id="@course.Id" method="post" onsubmit="return confirm('Are you sure you want to delete this course?');" style="display:inline;">
                                        <button type="submit" class="text-red-400 hover:text-red-300 transition-colors" title="Delete">
                                            <i data-feather="trash-2" class="w-4 h-4"></i>
                                        </button>
                                    </form>

                                </div>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            feather.replace();
        });
    </script>
}