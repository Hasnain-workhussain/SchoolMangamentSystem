@model IEnumerable<SchoolMangamentSystem.ViewModels.Grade>

@{
    ViewData["Title"] = "Grades Management";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    // Cast the ViewBag dictionary for easy access
    var studentNames = ViewBag.StudentNames as Dictionary<int, string>;
}

<div class="p-6">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-indigo-400">Grades Management</h1>
        <a asp-action="Create" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition shadow-lg shadow-indigo-500/20">
            <i data-feather="plus" class="w-4 h-4"></i>
            <span>Add Grade</span>
        </a>
    </div>

    <div class="bg-slate-800 rounded-xl shadow-lg p-6 mb-6 border border-slate-700">
        <div class="overflow-x-auto">
            <table class="w-full text-left text-slate-300">
                <thead class="border-b border-slate-700 text-slate-400 uppercase text-xs tracking-wider">
                    <tr>
                        <th class="pb-3 px-4 font-medium">Student Name</th>
                        <th class="pb-3 px-4 font-medium">Course</th>
                        <th class="pb-3 px-4 font-medium">Mid-Term</th>
                        <th class="pb-3 px-4 font-medium">Quiz</th>
                        <th class="pb-3 px-4 font-medium">Final-Term</th>
                        <th class="pb-3 px-4 font-medium">GPA</th>
                        <th class="pb-3 px-4 font-medium">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-700">
                    @if (!Model.Any())
                    {
                        <tr><td colspan="7" class="p-6 text-center text-slate-500">No grades recorded.</td></tr>
                    }
                    else
                    {
                        @foreach (var item in Model)
                        {
                            <tr class="hover:bg-slate-700/30 transition-colors">
                                <td class="py-4 px-4 font-medium text-white">
                                    @if (studentNames != null && studentNames.ContainsKey(item.StudentId))
                                    {
                                        @studentNames[item.StudentId]
                                    }
                                    else
                                    {
                                        <span class="text-red-400">Unknown (ID: @item.StudentId)</span>
                                    }
                                </td>
                                <td class="py-4 px-4">
                                    <span class="bg-slate-700 px-2 py-1 rounded text-xs text-slate-300 border border-slate-600">
                                        @item.CourseName
                                    </span>
                                </td>
                                <td class="py-4 px-4">@item.MidTerm</td>
                                <td class="py-4 px-4">@item.Quiz</td>
                                <td class="py-4 px-4">@item.FinalTerm</td>
                                <td class="py-4 px-4 font-bold text-indigo-400">@item.GPA</td>
                                <td class="py-4 px-4 flex gap-2">
                                    <a asp-action="Edit" asp-route-id="@item.Id" class="text-indigo-400 hover:text-indigo-300 transition-colors p-2 hover:bg-slate-700 rounded-full">
                                        <i data-feather="edit-2" class="w-4 h-4"></i>
                                    </a>
                                    <form asp-action="Delete" asp-route-id="@item.Id" method="post" onsubmit="return confirm('Delete this record?');">
                                        <button type="submit" class="text-red-400 hover:text-red-300 transition-colors p-2 hover:bg-slate-700 rounded-full">
                                            <i data-feather="trash-2" class="w-4 h-4"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", () => feather.replace());
    </script>
}